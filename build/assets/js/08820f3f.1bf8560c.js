"use strict";(self.webpackChunkhaochen_blog=self.webpackChunkhaochen_blog||[]).push([[4073],{3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>f});var o=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,o)}return a}function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,o,r=function(e,t){if(null==e)return{};var a,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)a=i[o],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)a=i[o],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=o.createContext({}),p=function(e){var t=o.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):n(n({},t),e)),a},l=function(e){var t=p(e.components);return o.createElement(c.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(a),h=r,f=u["".concat(c,".").concat(h)]||u[h]||d[h]||i;return a?o.createElement(f,n(n({ref:t},l),{},{components:a})):o.createElement(f,n({ref:t},l))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,n=new Array(i);n[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[u]="string"==typeof e?e:r,n[1]=s;for(var p=2;p<i;p++)n[p]=a[p];return o.createElement.apply(null,n)}return o.createElement.apply(null,a)}h.displayName="MDXCreateElement"},6077:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>n,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var o=a(7462),r=(a(7294),a(3905));const i={slug:"protect-app-service-from-ddos-attacks",title:"How to Protect Your Azure App Service App from DDoS Attacks",author:"Haochen Qi",author_title:"Full Stack Developer",author_url:"https://github.com/HaochenQ",author_image_url:"https://avatars1.githubusercontent.com/u/44130343?s=400&u=a5a4729addf5c5b972d1d6220546273ff6e00eb4&v=4",tags:["Azure App Service","DDoS","Application Gateway","WAF"]},n=void 0,s={permalink:"/blog/protect-app-service-from-ddos-attacks",source:"@site/blog/2022-10-17-how-to-mitigate-DDoS-for-app-service.md",title:"How to Protect Your Azure App Service App from DDoS Attacks",description:"banner-ddos",date:"2022-10-17T00:00:00.000Z",formattedDate:"October 17, 2022",tags:[{label:"Azure App Service",permalink:"/blog/tags/azure-app-service"},{label:"DDoS",permalink:"/blog/tags/d-do-s"},{label:"Application Gateway",permalink:"/blog/tags/application-gateway"},{label:"WAF",permalink:"/blog/tags/waf"}],readingTime:4.805,hasTruncateMarker:!0,authors:[{name:"Haochen Qi",title:"Full Stack Developer",url:"https://github.com/HaochenQ",imageURL:"https://avatars1.githubusercontent.com/u/44130343?s=400&u=a5a4729addf5c5b972d1d6220546273ff6e00eb4&v=4"}],frontMatter:{slug:"protect-app-service-from-ddos-attacks",title:"How to Protect Your Azure App Service App from DDoS Attacks",author:"Haochen Qi",author_title:"Full Stack Developer",author_url:"https://github.com/HaochenQ",author_image_url:"https://avatars1.githubusercontent.com/u/44130343?s=400&u=a5a4729addf5c5b972d1d6220546273ff6e00eb4&v=4",tags:["Azure App Service","DDoS","Application Gateway","WAF"]},nextItem:{title:"Map your Custom Domain to Your App Service App",permalink:"/blog/azure-app-service-custom-domain"}},c={authorsImageUrls:[void 0]},p=[{value:"What is DDoS",id:"what-is-ddos",level:2},{value:"Dynamic IP Restriction",id:"dynamic-ip-restriction",level:2},{value:"Azure DDoS Protection Standard",id:"azure-ddos-protection-standard",level:2},{value:"Integrate Azure App Service app with Application Gateway",id:"integrate-azure-app-service-app-with-application-gateway",level:3},{value:"DNS Configuration",id:"dns-configuration",level:4},{value:"TLS bindings",id:"tls-bindings",level:4},{value:"Configure your Application Gateway",id:"configure-your-application-gateway",level:4},{value:"Enable the DDoS Protection",id:"enable-the-ddos-protection",level:3},{value:"Summary",id:"summary",level:2}],l={toc:p},u="wrapper";function d(e){let{components:t,...i}=e;return(0,r.kt)(u,(0,o.Z)({},l,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"banner-ddos",src:a(5191).Z,width:"2240",height:"1260"})),(0,r.kt)("p",null,"Azure App Service is a PaaS offering and its components, including Azure VMs, storage, network connections, web frameworks, management and integration features, are actively secured and hardened. It has a basic level of DDoS protection."),(0,r.kt)("p",null,"However, this basic layer of protection can be limited when facing large-scale attacks."),(0,r.kt)("h2",{id:"what-is-ddos"},"What is DDoS"),(0,r.kt)("p",null,"Distributed denial of Service (DDoS) is a common attack towards a web application to exhaust its resources with a flood of traffic. As a result, the web application will exhibit as unavaiable to it legitmate users."),(0,r.kt)("p",null,"You can identify a DDoS attack with the below features","[1]",":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Suspicious amounts of traffic originating from a single IP address or IP range"),(0,r.kt)("li",{parentName:"ul"},"A flood of traffic from users who share a single behavioral profile, such as device type, geolocation, or web browser version"),(0,r.kt)("li",{parentName:"ul"},"An unexplained surge in requests to a single page or endpoint"),(0,r.kt)("li",{parentName:"ul"},"Odd traffic patterns such as spikes at odd hours of the day or patterns that appear to be unnatural (e.g. a spike every 10 minutes)")),(0,r.kt)("h2",{id:"dynamic-ip-restriction"},"Dynamic IP Restriction"),(0,r.kt)("p",null,"If you are using App Service Windows, you can make use of Dynamic IP Restriction(DIPR) feature of IIS(Internet Information Service) webserver. You can add an extension from Azure Portal called ",(0,r.kt)("strong",{parentName:"p"},"Dynamic IP Restriction for App Services"),". With this extension, you can define blocking rules on IPs based on their accessing patterns."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The number of concurrent requests made."),(0,r.kt)("li",{parentName:"ul"},"The number of requests made in certain interval of time.\n",(0,r.kt)("img",{alt:"DIPR",src:a(4630).Z,width:"710",height:"346"}),(0,r.kt)("img",{alt:"DIPR",src:a(8382).Z,width:"987",height:"536"}))),(0,r.kt)("p",null,"This extension will create special configuration file ",(0,r.kt)("strong",{parentName:"p"},"applicationHost.xdt")," in C:\\home\\site based on your customized rules. For more information about the usage of this extension, please refer to ",(0,r.kt)("a",{parentName:"p",href:"https://techcommunity.microsoft.com/t5/apps-on-azure-blog/dynamic-ip-restriction-for-app-services/ba-p/1150049"},"Dynamic IP Restriction for App Services"),"."),(0,r.kt)("h2",{id:"azure-ddos-protection-standard"},"Azure DDoS Protection Standard"),(0,r.kt)("p",null,"Another option is to purchase an Azure DDoS Standard plan and configure it with Application Gateway WAF or Azure Front Door WAF. It is worth mentioning that Azure DDoS Protection Standard(Metwork) only has a fixed monthly bill of $2,944 (as of October 2022). There is also a IP Protection plan will be in public preview soon."),(0,r.kt)("p",null,"To use this service, your App Service app needs to be behind of a WAF enable load balancing service like Application Gateway."),(0,r.kt)("h3",{id:"integrate-azure-app-service-app-with-application-gateway"},"Integrate Azure App Service app with Application Gateway"),(0,r.kt)("p",null,"First of all, we need to create a Application Gateway with WAF enabled ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/application-gateway/quick-create-portal"},"Quickstart: Direct web traffic with Azure Application Gateway - Azure portal"),". To integrare the Application Gateway with App Service, there two options."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The first option makes use of a custom domain on both ","[Application Gateway and the App Service in the backend][3]","."),(0,r.kt)("li",{parentName:"ul"},'The second option is to have Application Gateway access App Service using its default domain, suffixed as ".azurewebsites.net".')),(0,r.kt)("p",null,"Generally, we all have a custom domain mapped to our App Service app, so we choose the first option."),(0,r.kt)("h4",{id:"dns-configuration"},"DNS Configuration"),(0,r.kt)("p",null,"In terms of the DNS settings, we need to add a CNAME or A record at the DNS provider and map our custom domain to the Application Gateway (Default Domain or Public IP address.) If you would like to use a CNAME record, you need to go to the App GW Public IP on Azure Portal and set up a DNS name lable for this IP. After which, your IP will has a name like yourcustomname.region.cloudapp.azure.com. ",(0,r.kt)("img",{alt:"Public IP",src:a(2528).Z,width:"1133",height:"558"})),(0,r.kt)("p",null,"If you have configured the custom domain directly for your App Service before, remeber to remove your old DNS records. The DNS configuration for the custom domain will be directed towards Application Gateway."),(0,r.kt)("h4",{id:"tls-bindings"},"TLS bindings"),(0,r.kt)("p",null,"Because we need to use the certificate at both App Service side and the Application Gateway side, the free App Service managed certificate would not meet the needs. You need to purchase a certificate for your custom domain and generate a PFX version for the later usage. After acquiring the PFX version of the certificate, upload it to Azure App Service at ",(0,r.kt)("strong",{parentName:"p"},"Azure Portal >> TLS/SSL settings >> Private Key Certificates (.pfx) >> Upload Certificate"),". If you purchased your certificate from App Service, you can choose ",(0,r.kt)("strong",{parentName:"p"},"Import App Service Certificate"),", dowload the certificate from KeyVault and generate a PFX version. You can follow this ",(0,r.kt)("a",{parentName:"p",href:"https://dotnetdevlife.wordpress.com/2019/06/06/export-azure-app-service-certificate-upload-to-azure-app-service-website/#:~:text=1.%20Go%20to%20App%20Service%20Certificate%20in%20Azure,NOTE%3A%20this%20pfx%20file%20has%20empty%20password%205."},"tutorial")," to achieve this."),(0,r.kt)("h4",{id:"configure-your-application-gateway"},"Configure your Application Gateway"),(0,r.kt)("p",null,"Now we need to configure your Application gateway. We need to create a backend pool and set our App Service as the backend target. After which, we need to create an HTTPS Backend setting and be sure to choose No for ",(0,r.kt)("strong",{parentName:"p"},"Override with new host name"),". You shoule also create a Custom probe and use your custom domain as the Host and the HTTPS settings we just created.\n",(0,r.kt)("img",{alt:"backend setting",src:a(9927).Z,width:"843",height:"879"}),"\n",(0,r.kt)("img",{alt:"health probe",src:a(8549).Z,width:"667",height:"592"})),(0,r.kt)("p",null,"The we need to create a listener and upload the PFX certificate you created in the last step and write your custom domain in Host name. After configuring the listener, create a new rule to connect the listener and the backend pool.\n",(0,r.kt)("img",{alt:"listener",src:a(887).Z,width:"637",height:"767"})),(0,r.kt)("p",null,"If you have configured the Application Geteway properly, now when you visit your app with the custom domain, you should be using the Application Gateway. You can now go to the Access Restriction of your App and only allow the traffic from the subnet of the virtual network(VNET) where your Application Gateway resides in."),(0,r.kt)("h3",{id:"enable-the-ddos-protection"},"Enable the DDoS Protection"),(0,r.kt)("p",null,"The Last steps is to create a DDoS Protection plan and enable DDoS protection for the VNET where your Application gateway is. Please refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/ddos-protection/manage-ddos-protection"},"Quickstart: Create and configure Azure DDoS Network Protection using the Azure portal")," for detailed steps."),(0,r.kt)("h2",{id:"summary"},"Summary"),(0,r.kt)("p",null,"In this article, we have learned two ways on how to protect your App Service apps from DDoS sttacks. The first one is using Dynamic IP restriction and the second one is to leverage Azure DDoS Protection Plan."),(0,r.kt)("p",null,"Reference:",(0,r.kt)("br",null),"\n","[1]"," ",(0,r.kt)("a",{parentName:"p",href:"https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack/"},"https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack/")," ",(0,r.kt)("br",null),"\n","[2]"," ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/app-service/overview-security"},"https://learn.microsoft.com/en-us/azure/app-service/overview-security"),(0,r.kt)("br",null),"\n","[3]"," ",(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/azure/application-gateway/configure-web-app?tabs=customdomain%2Cazure-portal"},"https://learn.microsoft.com/en-us/azure/application-gateway/configure-web-app?tabs=customdomain%2Cazure-portal")))}d.isMDXComponent=!0},5191:(e,t,a)=>{a.d(t,{Z:()=>o});const o=a.p+"assets/images/DDoS-c3b597d642491d130ac0384f2d29248f.jpg"},4630:(e,t,a)=>{a.d(t,{Z:()=>o});const o=a.p+"assets/images/DIPR-33411d6988803edd5c143a37f2a8e6ce.jpg"},9927:(e,t,a)=>{a.d(t,{Z:()=>o});const o=a.p+"assets/images/backend-setting-2adf74712022e86936305d5fd83bed73.jpg"},8382:(e,t,a)=>{a.d(t,{Z:()=>o});const o=a.p+"assets/images/gui-DIPR-eac606ab3d0c03367f0ea1b8538b49b2.jpg"},8549:(e,t,a)=>{a.d(t,{Z:()=>o});const o=a.p+"assets/images/health-probe-e075849be516b11dc9ba351308e78cbf.jpg"},887:(e,t,a)=>{a.d(t,{Z:()=>o});const o=a.p+"assets/images/listener-ca0a2f28fd3556bcf9392bea1c7b8d92.jpg"},2528:(e,t,a)=>{a.d(t,{Z:()=>o});const o=a.p+"assets/images/publicIP-8ef51b79c58ccb88665de39e83c9cb5d.jpg"}}]);