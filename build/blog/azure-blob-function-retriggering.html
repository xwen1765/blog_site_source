<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Azure Blob Functions&#x27;s Re-triggering Issue - Xuan Wen</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://xwen1765.github.io/blog/azure-blob-function-retriggering"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Azure Blob Functions&#x27;s Re-triggering Issue - Xuan Wen"><meta data-rh="true" name="description" content="azure-functions"><meta data-rh="true" property="og:description" content="azure-functions"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-01-06T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/HaochenQ"><meta data-rh="true" property="article:tag" content="Azure App Service,Blob Function,Azure Functions,Paas"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xwen1765.github.io/blog/azure-blob-function-retriggering"><link data-rh="true" rel="alternate" href="https://xwen1765.github.io/blog/azure-blob-function-retriggering" hreflang="en"><link data-rh="true" rel="alternate" href="https://xwen1765.github.io/zh-cn/blog/azure-blob-function-retriggering" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://xwen1765.github.io/blog/azure-blob-function-retriggering" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Xuan Wen RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Xuan Wen Atom Feed">



<link rel="stylesheet" href="https://fonts.font.im/css?family=Raleway:500,700"><link rel="stylesheet" href="/assets/css/styles.fdec4b4c.css">
<link rel="preload" href="/assets/js/runtime~main.9ffe6eaa.js" as="script">
<link rel="preload" href="/assets/js/main.80833812.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/haochen.logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/haochen.logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Xuan Wen</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/blog/azure-blob-function-retriggering" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-cn/blog/azure-blob-function-retriggering" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://github.com/xwen1765" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/protect-app-service-from-ddos-attacks">How to Protect Your Azure App Service App from DDoS Attacks</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/azure-app-service-custom-domain">Map your Custom Domain to Your App Service App</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/azure-blob-function-retriggering">Azure Blob Functions&#x27;s Re-triggering Issue</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/understand-this-in-one-article">Understanding This, Bind, Call and Apply in JavaScript</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/upload-files-to-s3-iwth-node">How to Upload Files to AWS S3 in Node.js?</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Azure Blob Functions&#x27;s Re-triggering Issue</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-01-06T00:00:00.000Z" itemprop="datePublished">January 6, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/HaochenQ" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars1.githubusercontent.com/u/44130343?s=400&amp;u=a5a4729addf5c5b972d1d6220546273ff6e00eb4&amp;v=4" alt="Haochen Qi"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/HaochenQ" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Haochen Qi</span></a></div><small class="avatar__subtitle" itemprop="description">Full Stack Developer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="azure-functions" src="/assets/images/Azure_Functions-16cd12391d5727d3808eb163e8633103.png" width="1640" height="924" class="img_ev3q"></p><p>Azure Functions is an event-driven platform as a service provided by Microsoft Azure with which developers can focus less on infrastructure level complexity. Function app running on a consumption plan or an elastic plan will be charged per execution.</p><p>Some of you may have observed that your old blobs in a blob container re-triggered your blob function app even if you didn&#x27;t modify them which caused extra cost, especially when your Azure function is connected to some other cost-intensive services.</p><p>In this blog, let&#x27;s discuss the possible reasons for this blob function app anomaly.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-blob-trigger-function-work">How does Blob trigger function work?<a href="#how-does-blob-trigger-function-work" class="hash-link" aria-label="Direct link to How does Blob trigger function work?" title="Direct link to How does Blob trigger function work?">​</a></h2><p>Before digging into this issue, we need to understand how does azure blob function work. You may already know that Azure blob functions are functions integrated with azure blob storage, function apps will get triggered as blob storage data changes. But you may wonder how does the function knows there are changes and what is the way that azure function knows a blob already triggered it?</p><p>Azure blob trigger function will poll the blobs in the designated container, polling works as a hybrid between inspecting logs and running periodic container scans. Blobs are scanned in groups of 10,000 at a time with a continuation token used between intervals.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>In addition, <a href="https://docs.microsoft.com/en-us/rest/api/storageservices/About-Storage-Analytics-Logging" target="_blank" rel="noopener noreferrer">storage logs are created on a &quot;best effort&quot;</a> basis. There&#x27;s no guarantee that all events are captured. Under some conditions, logs may be missed.
If you require faster or more reliable blob processing, consider creating a <a href="https://docs.microsoft.com/en-us/azure/storage/queues/storage-dotnet-how-to-use-queues" target="_blank" rel="noopener noreferrer">queue message</a> when you create the blob. Then use a <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-queue" target="_blank" rel="noopener noreferrer">queue trigger</a> instead of a blob trigger to process the blob. Another option is to use Event Grid; see the tutorial <a href="https://docs.microsoft.com/en-us/azure/event-grid/resize-images-on-storage-blob-upload-event" target="_blank" rel="noopener noreferrer">Automate resizing uploaded images using Event Grid</a>.</p></div></div><p>Azure function keeps blob receipts to record the states of blobs. Blob receipts are stored in a container named <strong>azure-webjobs-hosts</strong> in the Azure storage account for your function app (defined by the app setting AzureWebJobsStorage). A blob receipt has the following information:</p><ul><li>The triggered function (<code>&lt;FUNCTION_APP_NAME&gt;.Functions.&lt;FUNCTION_NAME&gt;</code>, for example: MyFunctionApp.Functions.CopyBlob)</li><li>The container name</li><li>The blob type (<code>BlockBlob</code> or <code>PageBlob</code>)</li><li>The blob name</li><li>The ETag (a blob version identifier, for example: 0x8D1DC6E70A277EF)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-will-cause-the-old-blob-re-triggering-azure-function-issue">What will cause the old blob re-triggering Azure Function issue?<a href="#what-will-cause-the-old-blob-re-triggering-azure-function-issue" class="hash-link" aria-label="Direct link to What will cause the old blob re-triggering Azure Function issue?" title="Direct link to What will cause the old blob re-triggering Azure Function issue?">​</a></h2><p>After knowing the underlying mechanism of how the blob azure functions work, it is not hard to speculate the root cause for this issue.</p><p>If your function got re-triggered once, the possible reason might be the receipt got deleted/or updated somehow. However, in most cases, you will find all the old blobs in the container re-triggered your function. To find the cause for this false behavior, you can try to identify the actions performed around the time the issue occurred. You need to check you accidentally delete the whole <strong>azure-webjobs-hosts</strong> container or the virtual folder <strong>blobreceipts</strong> inside this container?</p><p>Another tricky situation is that you may find this all old blobs retriggered function issue after you updated your function name. As I mentioned above, the blob receipts are stored in a virtual folder with the structure of <code>&lt;FUNCTION_APP_NAME&gt;.Functions.&lt;FUNCTION_NAME&gt;</code>. After the modification of your function name, your function could not find the receipts that are associated with it anymore, as a result, it will treat all old blobs in your container as new ones which will get your function re-triggered.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>In a summary, Azure Blob Function leverages blob receipts to monitor the states of the blobs in your container. If you are facing the issue that old blobs(without any updates/modifications) are re-triggering your function, you can check whether you have accidentally deleted the blob receipts or you have changed the function name in which way your function can not find its associated receipts.</p><hr><p>Reference: <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-storage-blob-trigger?tabs=csharp" target="_blank" rel="noopener noreferrer">Azure Blob storage trigger for Azure Functions</a></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-app-service">Azure App Service</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blob-function">Blob Function</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-functions">Azure Functions</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/paas">Paas</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/azure-app-service-custom-domain"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Map your Custom Domain to Your App Service App</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/understand-this-in-one-article"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Understanding This, Bind, Call and Apply in JavaScript</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-does-blob-trigger-function-work" class="table-of-contents__link toc-highlight">How does Blob trigger function work?</a></li><li><a href="#what-will-cause-the-old-blob-re-triggering-azure-function-issue" class="table-of-contents__link toc-highlight">What will cause the old blob re-triggering Azure Function issue?</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/in/haochen-qi-a36393171/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Linkedin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/haochen.qi.520" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/xwen1765" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Xuan Wen. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.9ffe6eaa.js"></script>
<script src="/assets/js/main.80833812.js"></script>
</body>
</html>